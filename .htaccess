# .htaccess - Server-side protection for J. Danger Portfolio
# Comprehensive bot blocking and content protection

# Block known AI training and scraping bots
RewriteEngine On
RewriteCond %{HTTP_USER_AGENT} (GPTBot|ChatGPT-User|CCBot|anthropic-ai|Claude-Web|PerplexityBot|YouBot|Meta-ExternalAgent|FacebookBot|Google-Extended|Bard|Gemini|Bytespider|Applebot-Extended) [NC]
RewriteRule .* - [F,L]

# Block common scraping tools
RewriteCond %{HTTP_USER_AGENT} (wget|curl|scrapy|python-requests|node-fetch|axios|httpx) [NC]
RewriteRule .* - [F,L]

# Block data harvesting bots
RewriteCond %{HTTP_USER_AGENT} (ia_archiver|SemrushBot|AhrefsBot|MJ12bot|DotBot) [NC]
RewriteRule .* - [F,L]

# Rate limiting - max 10 requests per minute per IP
RewriteMap requests txt:/tmp/requests.txt
RewriteCond ${requests:%{REMOTE_ADDR}|0} >10
RewriteRule .* - [F,L]

# Security Headers
<IfModule mod_headers.c>
    # Prevent AI training and data mining
    Header always set X-Robots-Tag "noai, noimageai, noarchive, nosnippet"
    
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://fonts.googleapis.com https://fonts.gstatic.com; img-src 'self' data:; frame-ancestors 'none';"
    
    # Prevent framing and clickjacking
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    
    # Copyright and usage notice in headers
    Header always set X-Copyright "All content protected - No AI training permitted"
    Header always set X-License "All rights reserved - Contact signal@jackdanger.dev for permissions"
    
    # Referrer policy
    Header always set Referrer-Policy "no-referrer-when-downgrade"
</IfModule>

# Disable server signature
ServerSignature Off

# Hide .htaccess from being accessed
<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>

# Hide robots.txt from being modified
<Files robots.txt>
    <RequireAll>
        Require method GET
    </RequireAll>
</Files>

# Custom error pages to discourage scrapers
ErrorDocument 403 "Access Denied: This content is protected by copyright law. Unauthorized scraping or AI training is prohibited. Contact signal@jackdanger.dev for licensing inquiries."
ErrorDocument 429 "Rate Limited: Too many requests. This site is protected against automated scraping."

# MIME type security
<IfModule mod_mime.c>
    # Prevent execution of uploaded files
    AddType text/plain .txt .md
</IfModule>

# Disable directory browsing
Options -Indexes

# Force HTTPS (if SSL is available)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]